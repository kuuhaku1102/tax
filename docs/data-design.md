# 税理士マッチングサイト - データ設計書

## 設計思想

- **管理しやすさ最優先**: 人が変わっても運用できる構造
- **データとロジックの分離**: テンプレートに業務ロジックを書かない
- **拡張性の確保**: 課金モデル・表示ルール変更をコード修正なしで対応

---

## カスタム投稿タイプ

### tax_service（税理士サービス）

**概念**: 税理士「個人」ではなく「サービス単位」で管理

| 項目 | 値 |
|------|-----|
| スラッグ | `tax_service` |
| ラベル | 税理士サービス |
| 公開 | はい |
| アーカイブ | はい |
| リライト | `/services/` |
| サポート | title, editor, thumbnail |

**設計意図**:
- 1税理士が複数サービスを提供する場合に対応
- サービス単位で掲載プラン・優先度を管理
- 将来的な課金モデル変更に耐える構造

---

## タクソノミー設計

### 基本方針

- **変更頻度が低い**: 専用タクソノミー
- **変更頻度が高い**: `service_tag` に集約
- **階層構造が必要**: `hierarchical => true`

### タクソノミー一覧

#### 1. service_industry（業種）

| 項目 | 値 |
|------|-----|
| スラッグ | `service_industry` |
| ラベル | 業種 |
| 階層構造 | あり |
| 変更頻度 | 低 |

**想定タームの例**:
- 飲食業
- 小売業
- IT・Web
- 建設業
- 医療・介護
- 不動産業

**設計意図**: 業種は基本的に固定。階層構造で「飲食業 > カフェ」のような分類も可能。

---

#### 2. service_issue（課題・目的）

| 項目 | 値 |
|------|-----|
| スラッグ | `service_issue` |
| ラベル | 課題・目的 |
| 階層構造 | あり |
| 変更頻度 | 低 |

**想定タームの例**:
- 確定申告
- 法人設立
- 節税対策
- 相続・事業承継
- 資金調達支援
- 経営コンサル

**設計意図**: ユーザーの「困りごと」ベースで分類。マッチング精度向上に寄与。

---

#### 3. service_phase（フェーズ）

| 項目 | 値 |
|------|-----|
| スラッグ | `service_phase` |
| ラベル | フェーズ |
| 階層構造 | なし |
| 変更頻度 | 中 |

**想定タームの例**:
- 起業準備中
- 創業1年未満
- 創業3年未満
- 成長期
- 成熟期
- 事業承継期

**設計意図**: 事業フェーズに応じたマッチング。将来的に細分化の可能性あり。

---

#### 4. service_area（対応エリア）

| 項目 | 値 |
|------|-----|
| スラッグ | `service_area` |
| ラベル | 対応エリア |
| 階層構造 | あり |
| 変更頻度 | 低 |

**想定タームの例**:
- 全国対応
- 東京都
  - 千代田区
  - 中央区
  - 港区
- 神奈川県
- 大阪府

**設計意図**: 階層構造で「都道府県 > 市区町村」を表現。全国対応も選択可能。

---

#### 5. service_tag（補助タグ）

| 項目 | 値 |
|------|-----|
| スラッグ | `service_tag` |
| ラベル | タグ |
| 階層構造 | なし |
| 変更頻度 | 高 |

**想定タームの例**:
- オンライン対応
- 夜間対応
- 英語対応
- 女性税理士
- 若手税理士
- ベテラン税理士

**設計意図**: 頻繁に追加・変更される属性はここに集約。タクソノミーの乱立を防ぐ。

---

## ACFフィールド設計

### 設計原則

1. **意味のある単位で切る**: `text_1` のような無意味な名前は禁止
2. **編集者の役割を明確化**: 誰が触るフィールドかを決める
3. **空の場合は表示しない**: テンプレート側で存在チェック必須

### フィールドグループ: 基本情報

**対象**: tax_service  
**編集者**: 管理者  
**役割**: サービスの基本的な表示情報

| フィールド名 | タイプ | ラベル | 説明 |
|------------|--------|--------|------|
| `office_name` | text | 事務所名 | 税理士事務所の正式名称 |
| `representative_name` | text | 代表者名 | 代表税理士の氏名 |
| `office_url` | url | 事務所URL | 公式サイトのURL |
| `office_tel` | text | 電話番号 | 問い合わせ用電話番号 |
| `office_email` | email | メールアドレス | 問い合わせ用メール |
| `office_address` | textarea | 所在地 | 事務所の住所 |
| `catchcopy` | text | キャッチコピー | 一覧ページ用の短い説明 |

---

### フィールドグループ: 掲載制御

**対象**: tax_service  
**編集者**: 管理者  
**役割**: 表示・露出の管理

| フィールド名 | タイプ | ラベル | 説明 |
|------------|--------|--------|------|
| `listing_status` | true_false | 掲載ステータス | ON/OFF切替 |
| `listing_plan` | select | 掲載プラン | プレミアム/スタンダード/ベーシック |
| `priority_score` | number | 優先度スコア | 表示順序の数値（大きいほど上位） |
| `featured` | true_false | 注目サービス | トップページ掲載フラグ |
| `listing_start_date` | date_picker | 掲載開始日 | 掲載開始日時 |
| `listing_end_date` | date_picker | 掲載終了日 | 掲載終了日時（空なら無期限） |

**設計意図**:
- `listing_plan` は文字列だが、`priority_score` で数値化して並び替え
- 将来的な課金モデル変更に対応可能

---

### フィールドグループ: 編集部評価

**対象**: tax_service  
**編集者**: 編集担当  
**役割**: 信頼性・おすすめ度の管理

| フィールド名 | タイプ | ラベル | 説明 |
|------------|--------|--------|------|
| `editor_rating` | number | 編集部評価 | 1-5の数値評価 |
| `editor_good_points` | wysiwyg | おすすめポイント | 編集部のコメント |
| `editor_recommended_for` | wysiwyg | こんな人におすすめ | ターゲット層の説明 |
| `editor_note` | textarea | 編集部メモ | 非公開メモ（管理用） |

**設計意図**:
- 編集部の主観評価を数値化
- 将来的なAIマッチングのスコアリングに活用可能

---

### フィールドグループ: サービス詳細

**対象**: tax_service  
**編集者**: 管理者  
**役割**: サービス内容の詳細説明

| フィールド名 | タイプ | ラベル | 説明 |
|------------|--------|--------|------|
| `service_features` | wysiwyg | サービスの特徴 | 強み・特色の説明 |
| `service_flow` | wysiwyg | サービスの流れ | 相談から契約までの流れ |
| `pricing_info` | wysiwyg | 料金情報 | 料金体系の説明 |
| `consultation_method` | checkbox | 相談方法 | 対面/オンライン/電話/メール |
| `response_time` | select | 対応スピード | 即日/1営業日以内/3営業日以内 |

---

### フィールドグループ: トラッキング

**対象**: tax_service  
**編集者**: 運用担当  
**役割**: 分析・改善用データ

| フィールド名 | タイプ | ラベル | 説明 |
|------------|--------|--------|------|
| `view_count` | number | 閲覧数 | ページビュー数（自動更新） |
| `inquiry_count` | number | 問い合わせ数 | 問い合わせ件数（手動更新） |
| `conversion_rate` | number | 成約率 | 成約率（%） |
| `last_updated` | date_time_picker | 最終更新日時 | 情報更新日時 |

**設計意図**:
- 効果測定用のデータを投稿データとして管理
- 将来的なダッシュボード機能に活用

---

## テンプレート設計

### 設計原則

1. **1テンプレ = 1役割**
2. **条件分岐を極力持たせない**
3. **文言をPHPに直書きしない**

### テンプレート一覧

| ファイル名 | 役割 | 表示内容 |
|-----------|------|---------|
| `single-tax_service.php` | 詳細ページ | サービスの詳細情報 |
| `archive-tax_service.php` | 一覧ページ | サービスの一覧表示 |
| `taxonomy-service_industry.php` | 業種別一覧 | 業種で絞り込んだ一覧 |
| `taxonomy-service_issue.php` | 課題別一覧 | 課題で絞り込んだ一覧 |

---

## ヘルパー関数設計

### functions.php の構成

```
functions.php
├── カスタム投稿タイプ登録
├── タクソノミー登録
├── ACFフィールド登録（JSON同期推奨）
├── 管理画面カスタマイズ
└── inc/
    ├── helpers.php（ヘルパー関数）
    ├── query.php（クエリ関数）
    ├── display.php（表示関数）
    └── admin.php（管理画面関数）
```

### 主要ヘルパー関数

| 関数名 | 役割 |
|--------|------|
| `get_listing_plan_score()` | プラン名を数値スコアに変換 |
| `get_priority_services()` | 優先度順にサービスを取得 |
| `get_matched_services()` | マッチング条件でサービスを取得 |
| `display_service_card()` | サービスカードの表示 |
| `is_service_active()` | 掲載ステータスのチェック |

---

## 拡張性の確保

### 将来対応可能な変更

1. **課金プラン追加**
   - `listing_plan` に選択肢追加
   - `priority_score` の計算ロジック調整

2. **評価スコア追加**
   - ACFフィールド追加のみ
   - テンプレート修正不要

3. **AIマッチング追加**
   - `priority_score` の計算にAIスコアを組み込む
   - 既存構造を維持したまま拡張可能

---

## 禁止事項

❌ **やってはいけないこと**

1. テンプレートに業務ロジックを直書き
2. 固定文言をPHPに埋め込む
3. ACFフィールド名を `text_1` のような無意味な名前にする
4. タクソノミーを無計画に増やす
5. 設計意図のコメントを省略する

---

## まとめ

この設計書に基づいて実装することで、以下が実現されます：

✅ 管理者が変わっても運用できる
✅ 事業モデルが変わっても耐えられる
✅ AIが更新しても破綻しない

**次のステップ**: この設計書に基づいて、順次実装を進めます。
