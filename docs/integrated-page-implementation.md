# 統合ページの実装

## 概要

`/services/`ページに税理士サービスと税理士事務所を統合表示し、業種や地域で検索できるようにしました。

## 実装内容

### 1. ページ構造

```
/services/
├── ヘッダー: 「税理士を探す」
├── 統合検索フォーム
│   ├── 業種（税理士サービス用）
│   ├── 課題・目的（税理士サービス用）
│   ├── 対応エリア（税理士サービス用）
│   ├── 都道府県（税理士事務所用）
│   └── 並び順
├── セクション1: 税理士サービス（最大6件表示）
└── セクション2: 税理士事務所（最大12件表示）
```

### 2. 検索機能

#### 税理士サービスの検索
- **業種**: `service_industry`タクソノミーで絞り込み
- **課題・目的**: `service_issue`タクソノミーで絞り込み
- **対応エリア**: `service_area`タクソノミーで絞り込み

#### 税理士事務所の検索
- **都道府県**: `office_prefecture`タクソノミーで絞り込み
- **業種**: カスタムフィールド`_tax_office_services`と`_tax_office_industries`で検索
  - 業種フィルターを選択すると、得意分野または得意業種に該当する事務所を表示

### 3. 検索ロジック

#### 業種での横断検索
業種フィルターを選択すると：
1. 税理士サービス: `service_industry`タクソノミーで絞り込み
2. 税理士事務所: カスタムフィールド内を`LIKE`検索

```php
// 税理士事務所の業種検索
if (isset($_GET['service_industry']) && !empty($_GET['service_industry'])) {
    $search_term = get_term_by('slug', $_GET['service_industry'], 'service_industry');
    if ($search_term) {
        $office_query_args['meta_query'] = array(
            'relation' => 'OR',
            array(
                'key' => '_tax_office_services',
                'value' => $search_term->name,
                'compare' => 'LIKE',
            ),
            array(
                'key' => '_tax_office_industries',
                'value' => $search_term->name,
                'compare' => 'LIKE',
            ),
        );
    }
}
```

### 4. 表示件数

| セクション | 表示件数 | 理由 |
|-----------|---------|------|
| 税理士サービス | 6件 | 編集部が厳選したサービスを表示 |
| 税理士事務所 | 12件 | より多くの選択肢を提供 |

### 5. デザイン

#### セクションタイトル
- **アイコン**: 💼（税理士サービス）、🏛️（税理士事務所）
- **フォントサイズ**: 2rem
- **カラー**: #1e3a8a（ダークブルー）

#### セクション区切り
- 各セクション間に2pxのボーダー
- 税理士事務所セクションは背景にグラデーションを適用

#### カード表示
- 税理士サービス: 既存のカードデザイン
- 税理士事務所: 新しいカードデザイン（都道府県、得意分野を表示）

### 6. レスポンシブ対応

**モバイル表示時（768px以下）:**
- セクションタイトルを1.5remに縮小
- アイコンを2remに縮小
- セクション間のマージンを調整

## 使い方

### 基本的な検索
1. `/services/`ページにアクセス
2. 検索フォームで条件を選択
3. 「検索する」ボタンをクリック
4. 税理士サービスと税理士事務所の両方が絞り込まれて表示される

### 業種での横断検索
1. 「業種」フィルターで業種を選択（例: 「建設」）
2. 「検索する」ボタンをクリック
3. **税理士サービス**: 建設業向けのサービスが表示
4. **税理士事務所**: 得意分野または得意業種に「建設」を含む事務所が表示

### 都道府県での検索
1. 「都道府県」フィルターで都道府県を選択（例: 「東京都」）
2. 「検索する」ボタンをクリック
3. **税理士サービス**: 全件表示（フィルター影響なし）
4. **税理士事務所**: 東京都の事務所のみ表示

## メリット

1. **ワンストップ検索**: 1ページで税理士サービスと事務所の両方を検索できる
2. **横断検索**: 業種で両方を同時に絞り込める
3. **視認性**: セクション分けで見やすい
4. **柔軟性**: 各セクションで異なる表示件数を設定可能

## 今後の改善案

1. **フィルターの拡張**: 得意分野での直接検索
2. **ソート機能**: 人気順、評価順などの追加
3. **Ajax検索**: ページリロードなしで検索結果を更新
4. **お気に入り機能**: ユーザーがお気に入り登録できる機能
5. **比較機能**: 複数のサービス・事務所を比較できる機能

## 技術仕様

### ファイル
- **テンプレート**: `/archive-tax_service.php`
- **スタイル**: `/style.css`（統合ページ用スタイルを追加）

### クエリ
- **税理士サービス**: `WP_Query`で`tax_service`を取得
- **税理士事務所**: `WP_Query`で`tax_office`を取得

### 検索パラメータ
- `service_industry`: 業種（タクソノミースラッグ）
- `service_issue`: 課題・目的（タクソノミースラッグ）
- `service_area`: 対応エリア（タクソノミースラッグ）
- `office_prefecture`: 都道府県（タクソノミースラッグ）
- `orderby`: 並び順（priority, date, title）

## 注意事項

- 業種フィルターは税理士サービスと税理士事務所の両方に影響します
- 都道府県フィルターは税理士事務所のみに影響します
- 課題・目的、対応エリアフィルターは税理士サービスのみに影響します

---

**更新日**: 2026年1月20日  
**コミットハッシュ**: 0d1f8f4
