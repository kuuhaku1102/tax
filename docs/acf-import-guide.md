# ACFフィールドグループ インポート手順

## 前提条件

- Advanced Custom Fields（ACF）プラグインがインストール・有効化されていること
- ACF PRO版を推奨（無料版でも基本機能は使用可能）

---

## 自動同期による方法（推奨）

### 1. テーマファイルをデプロイ

GitHubにプッシュすると、自動的に以下のファイルがサーバーにデプロイされます：

```
/acf-json/
├── group_basic_info.json
├── group_listing_control.json
├── group_editor_review.json
├── group_service_detail.json
└── group_tracking.json
```

### 2. WordPress管理画面でACFを確認

1. WordPressにログイン
2. 左メニューから **「カスタムフィールド」** をクリック
3. 上部に **「同期可能」** というタブが表示されます
4. 以下の5つのフィールドグループが表示されるはずです：
   - 基本情報
   - 掲載制御
   - 編集部評価
   - サービス詳細
   - トラッキング・分析

### 3. フィールドグループを同期

1. すべてのフィールドグループにチェックを入れる
2. 下部の **「同期」** ボタンをクリック
3. 完了メッセージが表示されれば成功

---

## 手動インポートによる方法

自動同期がうまくいかない場合は、手動でインポートできます。

### 1. JSONファイルをダウンロード

GitHubリポジトリから以下のファイルをダウンロード：

- `acf-json/group_basic_info.json`
- `acf-json/group_listing_control.json`
- `acf-json/group_editor_review.json`
- `acf-json/group_service_detail.json`
- `acf-json/group_tracking.json`

### 2. ACFツールでインポート

1. WordPress管理画面にログイン
2. **「カスタムフィールド」** → **「ツール」** をクリック
3. **「インポート」** タブを選択
4. **「ファイルを選択」** をクリック
5. ダウンロードしたJSONファイルを1つずつ選択してインポート
6. すべてのファイルをインポートするまで繰り返す

---

## フィールドグループの確認

インポート後、以下を確認してください：

### 1. フィールドグループ一覧

**「カスタムフィールド」** → **「フィールドグループ」** で以下が表示されるはずです：

| フィールドグループ名 | 位置 | 対象 |
|-------------------|------|------|
| 基本情報 | 通常 | tax_service |
| 掲載制御 | サイドバー | tax_service |
| 編集部評価 | 通常 | tax_service |
| サービス詳細 | 通常 | tax_service |
| トラッキング・分析 | 通常 | tax_service |

### 2. 投稿編集画面で確認

1. **「税理士サービス」** → **「新規追加」** をクリック
2. 編集画面に以下のフィールドグループが表示されることを確認：
   - タイトル下に「基本情報」
   - 右サイドバーに「掲載制御」
   - 本文下に「編集部評価」「サービス詳細」「トラッキング・分析」

---

## フィールド一覧

### 基本情報（必須項目あり）

| フィールド名 | タイプ | 必須 |
|------------|--------|------|
| 事務所名 | テキスト | ✅ |
| 代表者名 | テキスト | - |
| 事務所URL | URL | - |
| 電話番号 | テキスト | - |
| メールアドレス | メール | - |
| 所在地 | テキストエリア | - |
| キャッチコピー | テキスト | - |

### 掲載制御

| フィールド名 | タイプ | 初期値 |
|------------|--------|--------|
| 掲載ステータス | ON/OFF | OFF |
| 注目サービス | ON/OFF | OFF |
| 掲載プラン | 選択 | ベーシック |
| 優先度スコア | 数値 | 50 |
| 掲載開始日 | 日付 | - |
| 掲載終了日 | 日付 | - |

### 編集部評価

| フィールド名 | タイプ | 初期値 |
|------------|--------|--------|
| 編集部評価 | 数値（1-5） | 3 |
| おすすめポイント | WYSIWYG | - |
| こんな人におすすめ | WYSIWYG | - |
| 編集部メモ | テキストエリア | - |

### サービス詳細

| フィールド名 | タイプ |
|------------|--------|
| サービスの特徴 | WYSIWYG |
| サービスの流れ | WYSIWYG |
| 料金情報 | WYSIWYG |
| 相談方法 | チェックボックス |
| 対応スピード | 選択 |

### トラッキング・分析

| フィールド名 | タイプ | 初期値 |
|------------|--------|--------|
| 閲覧数 | 数値 | 0 |
| 問い合わせ数 | 数値 | 0 |
| 成約率（%） | 数値 | 0 |
| 最終更新日時 | 日時 | - |

---

## トラブルシューティング

### 「同期可能」タブが表示されない

**原因**: ACFのJSON同期機能が無効になっている

**解決方法**:
1. `functions.php` に以下のコードが含まれているか確認：
   ```php
   add_filter('acf/settings/save_json', function($path) {
       return get_stylesheet_directory() . '/acf-json';
   });
   ```
2. `/acf-json/` ディレクトリが存在するか確認
3. JSONファイルが正しく配置されているか確認

### インポートエラーが発生する

**原因**: JSONファイルの形式が不正

**解決方法**:
1. JSONファイルをテキストエディタで開く
2. 構文エラーがないか確認
3. 文字コードがUTF-8であることを確認

### フィールドが表示されない

**原因**: フィールドグループの表示条件が正しくない

**解決方法**:
1. **「カスタムフィールド」** → **「フィールドグループ」** を開く
2. 各フィールドグループを編集
3. 下部の **「位置」** セクションで以下を確認：
   - 投稿タイプ = `tax_service`
4. 保存して再確認

---

## 次のステップ

ACFフィールドのインポートが完了したら、以下を実施してください：

1. **テストデータの作成**: 税理士サービスを1件作成して、すべてのフィールドが正しく動作するか確認
2. **タクソノミーの設定**: 業種・課題・フェーズ・エリア・タグのタームを追加
3. **テンプレートの確認**: 公開ページで正しく表示されるか確認

---

## 注意事項

### JSON同期の仕組み

- フィールドグループを管理画面で編集すると、自動的にJSONファイルが更新されます
- JSONファイルはGitで管理されるため、変更履歴が残ります
- 本番環境と開発環境でフィールド定義を同期できます

### フィールド名の変更禁止

**重要**: フィールド名（`name` 属性）は変更しないでください

- テンプレートファイルで使用されています
- 変更すると既存データが表示されなくなります
- ラベル（`label` 属性）の変更は問題ありません

### バックアップの推奨

フィールドグループを大幅に変更する前に、以下をバックアップしてください：

1. **「カスタムフィールド」** → **「ツール」** → **「エクスポート」**
2. すべてのフィールドグループを選択
3. **「エクスポートファイルを生成」** をクリック
4. JSONファイルをダウンロードして保存

---

## サポート

問題が解決しない場合は、以下を確認してください：

- ACFプラグインのバージョン（5.x以上を推奨）
- WordPressのバージョン（6.x以上を推奨）
- PHPのバージョン（7.4以上を推奨）

それでも解決しない場合は、`docs/data-design.md` を参照して、手動でフィールドグループを作成してください。
